import{d as lt,t as h,h as ct,a as _,s as g}from"../chunks/B16e2r4C.js";import{p as vt,a as y,b as S,u as v,c as X,e as r,f as o,h as C,i as pt,g as t,s as p,$ as ut,r as a,j as gt}from"../chunks/o3R3YUkc.js";import{i as j}from"../chunks/CVjyM36d.js";import{e as xt,i as mt,s as Y,a as ft,r as _t}from"../chunks/cOtZLUgG.js";import{c as ht,r as M,s as bt,a as yt,b as Ct,g as wt,d as Tt,p as $t}from"../chunks/D5flLAhQ.js";const kt=(w,u,x,T,l)=>{u?p(x,M(),!0):t(T).length&&(l(),p(x,M(),!0))},It=(w,u)=>{p(u,M(),!0)},St=(w,u,x)=>{p(u,$t(t(u),t(x).filteredChineseText),!0)};var jt=h('<span data-testid="typing-char"> </span>'),Mt=h('<div class="mb-4 text-center"><div class="text-sm text-gray-600 bg-gray-50 py-2 px-4 rounded-lg inline-block"> </div></div>'),Pt=h('<div class="mb-4"><input type="text" placeholder="開始打字..." class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg font-mono text-center" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-testid="typing-input"></div>'),zt=h('<div class="flex justify-center mb-4"><div class="flex gap-6 text-sm text-gray-600" data-testid="typing-stats"><span>速度: <span class="font-medium text-gray-800"> </span> 字/分鐘</span></div></div>'),At=h('<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" data-testid="completion-message"><div class="flex items-center"><img src="/icons/check.svg" alt="完成" class="h-5 w-5 mr-2"> <span class="font-medium">完成！</span></div> <div class="mt-3 grid grid-cols-3 gap-4 text-sm"><div class="text-center"><div class="text-gray-600 text-xs mb-1">速度</div> <div class="font-medium text-gray-800"> </div></div> <div class="text-center"><div class="text-gray-600 text-xs mb-1">用時</div> <div class="font-medium text-gray-800"> </div></div> <div class="text-center"><div class="text-gray-600 text-xs mb-1">字數</div> <div class="font-medium text-gray-800"> </div></div></div></div>'),Dt=h('<section class="w-full max-w-4xl mx-auto"><div class="bg-white rounded-lg shadow-md p-6 mb-6 max-w-xl mx-auto"><div class="mb-6"><h3 class="text-lg font-medium text-gray-700 mb-2">練習文本：</h3> <div class="bg-gray-50 p-4 rounded-lg border text-lg leading-relaxed font-mono" data-testid="typing-text-display"></div></div> <!> <!> <!> <!> <div class="flex flex-row gap-3 justify-center"><button class="flex items-center justify-center px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" data-testid="reset-button"><img src="/icons/refresh.svg" alt="重置" class="h-4 w-4 mr-2" style="filter: invert(1);"> 重新開始</button> <button class="flex items-center justify-center px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors" data-testid="next-text-button"><img src="/icons/arrow-right.svg" alt="下一個" class="h-4 w-4 mr-2" style="filter: invert(1);"> </button></div></div></section>');function Et(w,u){vt(u,!0);let x=!1,T=y(S([])),l=y(S([])),$=y(S([])),N=y(0);async function Z(){if(!t(l).length)try{const e=await fetch("/texts/snippets.json");if(e.ok){const s=await e.json();p(T,s.sources,!0),p(l,s.snippets,!0),O(),q(),p(i,M(),!0)}}catch(e){console.warn("Failed to load snippets:",e)}}function O(){p($,Array.from({length:t(l).length},(e,s)=>s),!0),bt(t($))}function q(){if(!t(l).length)return;t($).length===0&&O();const e=t($).pop();e!==void 0&&p(N,e,!0)}let i=y(S(ht()));const tt=e=>e[0],et=e=>t(T)[e[1]];let k=v(()=>t(l).length?t(l)[t(N)]:void 0),B=v(()=>t(k)?tt(t(k)):""),I=v(()=>t(k)?et(t(k)):void 0),P=v(()=>yt(t(B),t(i).userInput)),E=v(()=>Ct(t(i).completedChars,t(i).startTime||0,t(i).endTime||void 0));X(()=>{console.log("Current user input:",t(i).userInput)}),X(()=>{t(l).length===0&&Z()});var z=Dt();ct(e=>{ut.title="打字練習 - 速成查字"});var G=r(z),A=r(G),H=o(r(A),2);xt(H,21,()=>t(B).split(""),mt,(e,s,d)=>{var n=jt();const c=v(()=>wt(d,t(s),t(P))),m=v(()=>t(c).isChinese),f=v(()=>t(c).isCompletedChinese),b=v(()=>t(c).isCurrentChinese);Y(n,"data-char-index",d);var F=r(n,!0);a(n),C(()=>{ft(n,1,`${t(m)?t(f)?"bg-green-50 text-green-700":t(b)?"bg-blue-100 text-blue-700 animate-pulse":"text-gray-400 opacity-60":"text-gray-400 opacity-60"}`),Y(n,"data-char-state",t(m)?t(f)?"completed":t(b)?"current":"pending":"neutral"),g(F,t(s))}),_(e,n)}),a(H),a(A);var J=o(A,2);{var st=e=>{var s=Mt(),d=r(s),n=r(d);a(d),a(s),C(()=>g(n,`來源：${t(I).title??""}${(t(I).author?`（${t(I).author}）`:"")??""}`)),_(e,s)};j(J,e=>{var s;t(i).isCompleted&&((s=t(I))!=null&&s.title)&&e(st)})}var K=o(J,2);{var at=e=>{var s=Pt(),d=r(s);_t(d),d.__input=[St,i,P],a(s),Tt(d,()=>t(i).userInput,n=>t(i).userInput=n),_(e,s)};j(K,e=>{t(i).isCompleted||e(at)})}var L=o(K,2);{var rt=e=>{var s=zt(),d=r(s),n=r(d),c=o(r(n)),m=r(c,!0);a(c),gt(),a(n),a(d),a(s),C(()=>g(m,t(E))),_(e,s)};j(L,e=>{t(i).isCompleted||e(rt)})}var Q=o(L,2);{var it=e=>{var s=At(),d=o(r(s),2),n=r(d),c=o(r(n),2),m=r(c);a(c),a(n);var f=o(n,2),b=o(r(f),2),F=r(b);a(b),a(f);var V=o(f,2),W=o(r(V),2),dt=r(W);a(W),a(V),a(d),a(s),C(ot=>{g(m,`${t(E)??""} 字/分鐘`),g(F,`${ot??""} 秒`),g(dt,`${t(P).filteredChineseText.length??""} 字`)},[()=>t(i).startTime&&t(i).endTime?Math.round((t(i).endTime-t(i).startTime)/1e3):0]),_(e,s)};j(Q,e=>{t(i).isCompleted&&e(it)})}var R=o(Q,2),U=r(R);U.__click=[It,i];var D=o(U,2);D.__click=[kt,x,i,l,q];var nt=o(r(D));a(D),a(R),a(G),a(z),C(()=>g(nt," 下一個文本")),_(w,z),pt()}lt(["input","click"]);export{Et as component};
